<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./IMAGENS/Logo Icone.ico" type="image/x-icon">
    <title>Saída</title>
    <link rel="stylesheet" href="./SAÍDA/styles.css">
    <!-- Inclua o SDK do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_DOMINIO.firebaseapp.com",
            databaseURL: "https://SEU_DOMINIO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };
        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
</head>
<body>
    <header>
        <img src="./IMAGENS/Reciclar_Logo_Principal_Vertical_Negativo.png" alt="Logo" id="logo">
        <h1 id="titulo">SAÍDA</h1>
        <button id="homeButton">
            <img src="./IMAGENS/Layout.png" alt="Home Icon" id="homeIcon">
        </button>
    </header>
    <main>
        <form id="saidaForm">
            <label for="sku">SKU:</label>
            <input type="text" id="sku" name="sku">
            <label for="descricao">DESCRIÇÃO:</label>
            <input type="text" id="descricao" name="descricao">
            <label for="tipo">TIPO:</label>
            <input type="text" id="tipo" name="tipo">
            <label for="unidade">UNIDADE:</label>
            <input type="text" id="unidade" name="unidade">
            <label for="quantidade">QUANTIDADE:</label>
            <input type="text" id="quantidade" name="quantidade">

            <button type="button" onclick="adicionarSaida()">Adicionar</button>
            <button type="button" onclick="consultarDados()">Consultar</button> <!-- Botão de Consulta -->
        </form>
        <table>
            <thead>
                <tr>
                    <th>DATA</th>
                    <th>SKU</th>
                    <th>DESCRIÇÃO</th>
                    <th>QUANTIDADE</th>
                    <th>UNIDADE</th>
                    <th>TIPO</th>
                    <th>AÇÕES</th>
                </tr>
            </thead>
            <tbody id="saidaTableBody">
                <!-- Linhas da tabela serão adicionadas aqui -->
            </tbody>
        </table>
        <div class="buttons">
            <button type="button" onclick="salvar()">Salvar</button>
            <button type="button" onclick="alterar()">Alterar</button>
            <button type="button" onclick="limpar()">Limpar</button>
        </div>
    </main>
    <script src="./SAÍDA/script.js"></script>
    <script>
        const dbRef = firebase.database().ref("entradaprodutos");

        // Função para consultar dados no Firebase
        function consultarDados() {
            const skuInput = document.getElementById('sku').value;

            // Consulta com base no SKU
            dbRef.orderByChild('sku').equalTo(skuInput).once('value', snapshot => {
                if (snapshot.exists()) {
                    snapshot.forEach(childSnapshot => {
                        const data = childSnapshot.val();
                        
                        // Exibe os dados na tabela
                        const tableBody = document.getElementById('saidaTableBody');
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td>${new Date().toLocaleDateString()}</td>
                            <td>${data.sku}</td>
                            <td>${data.descricao}</td>
                            <td>${data.quantidade}</td>
                            <td>${data.unidade}</td>
                            <td>${data.tipo}</td>
                            <td>
                                <button class="acaoButton" onclick="editarLinha(this, '${childSnapshot.key}')">Editar</button>
                                <button class="acaoButton" onclick="excluirDados('${childSnapshot.key}')">Excluir</button>
                            </td>`;
                        
                        tableBody.appendChild(newRow);
                    });
                } else {
                    alert('Nenhum produto encontrado com este SKU.');
                }
            }).catch(error => {
                console.error('Erro ao consultar dados:', error);
            });
        }

        // Função para excluir dados do Firebase
        function excluirDados(key) {
            const confirmDelete = confirm('Tem certeza que deseja excluir este produto?');
            if (confirmDelete) {
                dbRef.child(key).remove()
                .then(() => {
                    alert('Produto excluído com sucesso!');
                    // Atualiza a tabela removendo a linha correspondente
                    document.getElementById('saidaTableBody').innerHTML = '';
                })
                .catch(error => {
                    console.error('Erro ao excluir produto:', error);
                });
            }
        }

        // Função para editar linha
        function editarLinha(button, key) {
            const row = button.parentNode.parentNode;
            const sku = row.cells[1].innerText;
            const descricao = row.cells[2].innerText;
            const quantidade = row.cells[3].innerText;
            const unidade = row.cells[4].innerText;
            const tipo = row.cells[5].innerText;

            // Preenche o formulário com os dados para edição
            document.getElementById('sku').value = sku;
            document.getElementById('descricao').value = descricao;
            document.getElementById('quantidade').value = quantidade;
            document.getElementById('unidade').value = unidade;
            document.getElementById('tipo').value = tipo;

            // Remove a linha da tabela
            row.remove();
        }
    </script>
</body>
</html>
